---
import Advent24Layout from '../layouts/Advent24Layout.astro'
import XmasSquare from '../components/XmasSquare.astro'
---

<Advent24Layout
  title="Julkalendern 2024"
  description="asdfs julkalender 2024 är ambitiösare än någonsin, öppna alla luckor för att inte missa någon av våra fantastiska vänner"
>
  <div class="scroll-container">
    <div class="inner">
      <XmasSquare
        text="1"
        x={2050}
        y={1050}
        url="https://open.spotify.com/episode/6HQ3ozUHghFh5Ji6FqZMd1?si=4e7b1d10823a4249"
        enabled={true}
      >
        <img src="/salma.png" />
      </XmasSquare>
      <XmasSquare
        text="2"
        x={4600}
        y={2600}
        enabled={true}
        url="https://open.spotify.com/episode/4pYjqzHl2tc6iaeNawpnmV?si=1368654630674904"
      >
        <img src="/erik.png" />
      </XmasSquare>
      <XmasSquare
        text="3"
        x={1500}
        y={2400}
        enabled={true}
        url="https://open.spotify.com/episode/6pnoRKDp7HFHociqRX7zvm?si=bd48543c5f7d4332"
      >
        <img src="/kent.png" />
      </XmasSquare>
      <XmasSquare
        text="4"
        x={4000}
        y={550}
        enabled={true}
        url="https://open.spotify.com/episode/2nMG4YSfEDhWhzWdgHkm7l?si=e212bc5247084ffd"
      >
        <img src="/jader.png" />
      </XmasSquare>
      <XmasSquare
        text="5"
        x={1000}
        y={1250}
        enabled={true}
        url="https://open.spotify.com/episode/7v6N7jB8uW5OBvGbcGt4gz?si=133e0efd0b7a4903"
      >
        <img src="/bartek.png" />
      </XmasSquare>
      <XmasSquare
        text="6"
        x={2800}
        y={2000}
        enabled={true}
        url="https://open.spotify.com/episode/2W2K4sSwihysKBiQuAzZOu?si=e4b344b6a93c440a"
      >
        <img src="/emil.png" />
      </XmasSquare>
      <XmasSquare
        text="7"
        x={100}
        y={2400}
        enabled={true}
        disableShadow={true}
        url="https://open.spotify.com/episode/7xrDGqwL8UTFlyTmvdpL3s?si=e4a0f8fe7ecc46f2"
      >
        <img src="/josh.png" />
      </XmasSquare>
      <XmasSquare
        text="8"
        x={2950}
        y={50}
        enabled={true}
        url="https://open.spotify.com/episode/6PNJiufL9JPVsK8Wyb8iot?si=f3e5185641fd4d17"
      >
        <img src="/lu.png" />
      </XmasSquare>
      <XmasSquare
        text="9"
        x={1970}
        y={1850}
        enabled={true}
        url="https://open.spotify.com/episode/5vlAZ6yQbs1XhbELaBzPpR?si=73f925d1a7e04244"
      >
        <img src="/bjoreman.png" />
      </XmasSquare>
      <XmasSquare
        text="10"
        x={4500}
        y={1600}
        enabled={true}
        url="https://open.spotify.com/episode/4aMk8pI8mTTp1rjw19KpMe?si=756e386c94094afe"
      >
        <img src="/sara.png" />
      </XmasSquare>
      <XmasSquare
        text="11"
        x={800}
        y={150}
        enabled={true}
        url="https://open.spotify.com/episode/3llwBEdXAuTehjIoZtBVvT?si=0ed648a9ec694c83"
      >
        <img src="/jonny.png" />
      </XmasSquare>
      <XmasSquare
        text="12"
        x={3300}
        y={1100}
        enabled={true}
        url="https://open.spotify.com/episode/0pH0JD3PNY2Ltee7k44xqm?si=0b18509b47004c0b"
      >
        <img src="/nolen.png" />
      </XmasSquare>
      <XmasSquare
        text="13"
        x={250}
        y={1450}
        enabled={true}
        url="https://open.spotify.com/episode/0JhUqOYoJofXwmK330HBhh?si=634136caf74b48af"
      >
        <img src="/tilda.png" />
      </XmasSquare>
      <XmasSquare
        text="14"
        x={3655}
        y={2250}
        enabled={true}
        url="https://open.spotify.com/episode/1rJ3unJeaBIri9uICCY1QO?si=092da05d075a4a38"
      >
        <img src="/carson.png" />
      </XmasSquare>
      <XmasSquare
        text="15"
        x={1223}
        y={555}
        enabled={true}
        url="https://open.spotify.com/episode/5XYbwMzpyMbnztwuRVOWb9?si=dc196e830c504dfc"
      >
        <img src="/gabriella.png" />
      </XmasSquare>
      <XmasSquare
        text="16"
        x={4623}
        y={232}
        enabled={true}
        url="https://open.spotify.com/episode/2smGJDnoPurOkyV1VGTWqu?si=ddab443f47744bcd"
      >
        <img src="/daniel.png" />
      </XmasSquare>
      <XmasSquare
        text="17"
        x={2623}
        y={1234}
        enabled={true}
        url="https://open.spotify.com/episode/42Tpg7WfKsUe2UUCBznJQp?si=32b07e3359db4c8c"
      >
        <img src="/svante.png" />
      </XmasSquare>
      <XmasSquare
        text="18"
        x={875}
        y={1850}
        enabled={true}
        url="https://open.spotify.com/episode/08V1CEnOlvJMNhoEAA3cM0?si=57888cc267a241cc"
      >
        <img src="/mary.png" />
      </XmasSquare>
      <XmasSquare
        text="19"
        x={4400}
        y={1085}
        enabled={true}
        url="https://open.spotify.com/show/48pKe510caxiFkvxtoXJge?si=c65cee8cb4314b23"
      >
        <img src="/woody.png" />
      </XmasSquare>
      <XmasSquare
        text="20"
        x={3695}
        y={1570}
        enabled={true}
        url="https://open.spotify.com/show/48pKe510caxiFkvxtoXJge?si=c65cee8cb4314b23"
      >
        <img src="fredrik.png" />
      </XmasSquare>
      <XmasSquare text="21" x={150} y={712} enabled={false}>HI</XmasSquare>
      <XmasSquare text="22" x={2410} y={2600} enabled={false}>HI</XmasSquare>
      <XmasSquare text="23" x={3350} y={450} enabled={false}>HI</XmasSquare>
      <XmasSquare text="24" x={2400} y={400} enabled={false}>HI</XmasSquare>
    </div>
    <img src="/advent24.png" alt="" />
  </div>
</Advent24Layout>

<style>
  .scroll-container {
    height: 100dvh;
    width: 100vw;
    overflow: hidden;
    position: relative;
  }
  .inner {
    width: 5000px;
    height: 3000px;
    position: absolute;
    inset: 0;
    overflow: hidden;
  }
  .img {
    position: absolute;
    top: 0;
    left: 0;
  }
</style>

<script>
  const container = document.querySelector('.scroll-container') as HTMLElement

  let isDragging = false
  let startX: number, startY: number, scrollLeft: number, scrollTop: number
  let lastX: number, lastY: number
  let velocityX = 0,
    velocityY = 0
  let momentumFrame: number | null = null

  container.addEventListener('mousedown', (e: MouseEvent) => {
    e.preventDefault()
    isDragging = true
    container.style.cursor = 'grabbing'

    const x = e.pageX
    const y = e.pageY

    onStart(x, y)
  })

  container.addEventListener(
    'touchstart',
    (e: TouchEvent) => {
      // e.preventDefault()
      isDragging = true

      const touch = e.touches[0]
      const x = touch.pageX
      const y = touch.pageY

      onStart(x, y)
    }
    // { passive: false }
  )

  container.addEventListener('mousemove', (e: MouseEvent) => {
    if (!isDragging) return
    e.preventDefault()

    const x = e.pageX
    const y = e.pageY

    onMove(x, y)
  })

  container.addEventListener(
    'touchmove',
    (e: TouchEvent) => {
      if (!isDragging) return
      e.preventDefault()

      const touch = e.touches[0]
      const x = touch.pageX
      const y = touch.pageY

      onMove(x, y)
    },
    { passive: false }
  )

  container.addEventListener('mouseup', onEnd)
  container.addEventListener('mouseleave', onEnd)
  container.addEventListener('touchend', onEnd)

  function onMove(x: number, y: number) {
    const deltaX = x - container.offsetLeft
    const deltaY = y - container.offsetTop
    const walkX = startX - deltaX
    const walkY = startY - deltaY

    // Calculate velocity
    velocityX = x - lastX
    velocityY = y - lastY

    lastX = x
    lastY = y

    container.scrollLeft = scrollLeft + walkX
    container.scrollTop = scrollTop + walkY
  }

  function onStart(x: number, y: number) {
    cancelMomentum() // Stop any existing momentum
    startX = x - container.offsetLeft
    startY = y - container.offsetTop
    scrollLeft = container.scrollLeft
    scrollTop = container.scrollTop

    lastX = x
    lastY = y

    velocityX = 0
    velocityY = 0
  }

  function onEnd() {
    isDragging = false
    container.style.cursor = 'grab'

    applyMomentum()
  }

  function applyMomentum() {
    const deceleration = 0.95 // Deceleration factor (lower = faster stop)
    const minVelocity = 0.5 // Minimum velocity to stop animation

    const momentum = () => {
      if (Math.abs(velocityX) > minVelocity || Math.abs(velocityY) > minVelocity) {
        container.scrollLeft -= velocityX
        container.scrollTop -= velocityY

        // Apply deceleration
        velocityX *= deceleration
        velocityY *= deceleration

        // Request the next frame
        momentumFrame = requestAnimationFrame(momentum)
      } else {
        cancelMomentum()
      }
    }

    momentum()
  }

  function cancelMomentum() {
    if (momentumFrame !== null) {
      cancelAnimationFrame(momentumFrame)
      momentumFrame = null
    }
  }
</script>
